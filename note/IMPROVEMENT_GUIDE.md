# 模型改進指南

## 🎯 改進目標

基於您的訓練結果分析，我們發現了以下主要問題：
1. **文本嵌入維度過高**：768維對於1000+樣本造成維度災難
2. **類別不平衡**：敗血症案例較少導致某些模型F1=0
3. **特徵雜訊干擾**：高維文本特徵干擾了強預測力的結構化特徵

## 🔧 改進措施

### 1. PCA降維
- 將768維文本嵌入降至50維
- 保留主要變異信息，減少雜訊
- 避免維度災難問題

### 2. 類別平衡處理
- 所有模型加入`class_weight='balanced'`
- 使用SMOTE過採樣技術
- 提高少數類別的預測能力

### 3. 改進版交叉驗證
- 每個fold內部重新處理數據
- 更穩健的性能評估
- 避免資料洩漏

## 📋 使用步驟

### 步驟1: 安裝依賴
```bash
pip install -r requirements_improved.txt
```

### 步驟2: 執行改進版訓練
```bash
python main_refresh_model.py
```
選擇選項：
- `1`: 只執行原始版本
- `2`: 只執行改進版本  
- `3`: 兩個版本都執行（推薦）

### 步驟3: 比較結果
```bash
python model_comparison.py
```

## 📊 預期改進效果

### 🎯 主要預期改進
1. **解決F1=0問題**：特別是y特徵組合中的SVM和CNN
2. **提高文本特徵效能**：y-pca和z-pca組合的整體表現
3. **改善特徵組合**：a-y-pca相比a-y應該有更好的F1分數
4. **增強模型穩定性**：減少交叉驗證的方差

### 📈 具體預期
- **y特徵組合**：F1從0.000提升至0.3+
- **a-y特徵組合**：F1從0.611提升至0.7+
- **整體穩定性**：減少±0.1以上的大方差
- **類別平衡**：Recall指標顯著提升

## ⚠️ 注意事項

### 可能的權衡
1. **訓練時間**：SMOTE處理會增加訓練時間
2. **記憶體使用**：PCA轉換需要額外記憶體
3. **模型複雜度**：需要保存PCA轉換器

### 實驗建議
1. **先運行小樣本測試**：確認改進版本正常運行
2. **比較關鍵指標**：重點關注F1和Recall的改善
3. **保存兩個版本**：方便後續比較和選擇

## 📁 輸出檔案說明

### 改進版輸出
- `models_improved/`: 改進版訓練模型
- `pca_*.pkl`: PCA轉換器（預測時需要）
- 詳細的交叉驗證輸出日誌

### 比較分析
- `model_improvement_comparison.png`: 性能改進可視化
- 詳細的比較報告和建議

## 🚀 下一步建議

1. **執行改進版訓練**
2. **比較兩個版本的結果**
3. **選擇最佳模型組合**
4. **保存最終模型用於實際預測**

## 💡 預期解決的問題

根據您的原始結果，改進版應該能解決：
- ✅ y特徵SVM的F1=0問題
- ✅ y特徵CNN的F1=0問題  
- ✅ a-y組合RF性能下降問題
- ✅ 高維特徵的穩定性問題
- ✅ 類別不平衡導致的預測偏差

執行改進版訓練後，您將能清楚看到這些改進的效果！